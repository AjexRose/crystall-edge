- type: constructionGraph
  id: CEMachine
  start: start
  graph:
    - node: start
      edges:
        - to: machineFrame
          conditions:
            - !type:EntityAnchored
          steps:
            - material: CEBrassBar
              amount: 2
              doAfter: 0.5

    - node: machineFrame
      entity: CEMachineFrame
      actions:
        - !type:AddContainer
          container: machine_parts
        - !type:AddContainer
          container: machine_board
        - !type:MachineFrameRegenerateProgress
      edges:
        - to: machine
          conditions:
            - !type:EntityAnchored
            - !type:MachineFrameComplete
              guideIconBoard:
                sprite: _CE/Structures/Industrial/machine_cores.rsi
                state: generic
              guideIconParts:
                sprite: _CE/Objects/Materials/machine_parts.rsi
                state: energy_line
          steps:
            - tool: Screwing
              doAfter: 0.5

        - to: machineFrame
          conditions:
            - !type:EntityAnchored
            - !type:ContainerNotEmpty
              container: machine_board
          steps:
            - tool: Prying
              doAfter: 2
              completed:
                - !type:EmptyAllContainers
                - !type:MachineFrameRegenerateProgress

        - to: start
          steps:
            - tool: Prying
              doAfter: 2
              completed:
                - !type:SpawnPrototype
                  prototype: CEBrassBar1
                  amount: 2
                - !type:DeleteEntity

    - node: machine
      entity: !type:BoardNodeEntity { container: machine_board }
      edges:
        - to: machineFrame
          completed:
            - !type:RaiseEvent
              event: !type:MachineDeconstructedEvent
              broadcast: false
          conditions:
            - !type:EntityAnchored
          steps:
            - tool: Prying
              doAfter: 2
    
    - node: destroyed
      entity: CEMachineFrameDestroyed
      actions:
        - !type:EmptyAllContainers
        - !type:MachineFrameRegenerateProgress
      edges:
        - to: start
          steps:
            - tool: Prying
              doAfter: 2
              completed:
                - !type:SpawnPrototype
                  prototype: CEScrapBrass1
                  amount: 2
                - !type:DeleteEntity
